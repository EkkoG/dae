global {
  # Bind to LAN and/or WAN as you want. Replace the interface name to your own.
  lan_interface: eth1, eth0
  wan_interface: eth1, eth0 # Use "auto" to auto detect WAN interface.

  log_level: trace
  allow_insecure: false
  auto_config_kernel_parameter: true
}

subscription {
  # Fill in your subscription links here.
  'https://ghproxy.imciel.com/https://gist.githubusercontent.com/ekkog/5c0e1e8218c5c0f3a492696f1010575b/raw/ss.txt'
}

node {
  # ekko-sg-ss: 'ss://YWVzLTI1Ni1nY206ejgwZWgya2sxZk5wUUk@s1.imciel.com:53191/?#ekko-sg-ss -> shadowtls://7dHomMp1XFGZ2m@45.32.111.113:443?sni=cdn-dynmedia-1.microsoft.com&version=3'
}

# See https://github.com/daeuniverse/dae/blob/main/docs/en/configuration/dns.md for full examples.
dns {
  upstream {
    current: 'tcp://dns.google:53'
    # googledns_td: 'tcp+udp://dns.google:53'
    # googledns_dt: 'udp+tcp://dns.google:53'
    # alidns: 'udp://dns.alidns.com:53'
    # alihttp3: 'http3://dns.alidns.com'
    # # current: 'h3://dns.alidns.com/dns-query'
    # doh: 'https://dns.alidns.com'
    # googleTLS: 'tls://dns.google:853'
    # googleh3: 'h3://8.8.8.8'
    # # current: 'h3://dns.google'
    # # quic: 'quic://dns.adguard.com'
    # # quic: 'quic://dns-unfiltered.adguard.com'
    # # quic: 'quic://1.1.1.1'
    # # quic: 'quic://cloudflare-dns.com'
    # quic: 'quic://dns.alidns.com:853'
    # # doh: 'https://cloudflare-dns.com'
    # # current: 'https://one.one.one.one/dns-query'
    # # current: 'https://one.one.one.one'
    # # current: 'https://dns.vlo.cc/jiu/acer'
    current: 'https://1.1.1.1'
    # # current: 'https://dns.google.com'

  }
  routing {
    request {
      # qname(full: wq.io) -> quic
      fallback: current
    }
    response {
      # upstream(googledns) -> accept
      # ip(geoip:private) && !qname(geosite:cn) -> googledns
      fallback: accept
    }
  }
}

group {
  proxy {
    #filter: name(keyword: HK, keyword: SG)
    policy: min_moving_avg
  }
}

# See https://github.com/daeuniverse/dae/blob/main/docs/en/configuration/routing.md for full examples.
routing {
  pname(NetworkManager) -> direct
  dip(224.0.0.0/3, 'ff00::/8') -> direct
  # dip('8.8.8.8/32') -> proxy
  # dip('1.1.1.1/32') -> proxy
  # domain(suffix: dns.google) -> proxy
  domain(suffix: httpbin.org) -> proxy
  domain(suffix: wq.io) -> proxy
  # domain(suffix: 'dns-unfiltered.adguard.com') -> proxy

  ### Write your rules below.

  # Disable h3 because it usually consumes too much cpu/mem resources.
  # l4proto(udp) && dport(443) -> block
#   dip(geoip:private) -> direct
#   dip(geoip:cn) -> direct
#   domain(geosite:cn) -> direct

  fallback: direct
}